# -*- coding: utf-8 -*-
"""
A simple example, have fun!
"""
__title__ = 'QGDT-cpu'
__author__ = 'Ex_treme'
__license__ = 'MIT'
__copyright__ = 'Copyright 2018, Ex_treme'

import os
import sys

sys.path.append(os.path.dirname(os.getcwd()))

from QGDT import QGDT

if __name__ == '__main__':
    """
    # 打开文件
    workbook = xlrd.open_workbook('EMDT抽取及挖掘结果(11818条).xlsx')
    # 获取所有sheet
    sheet_name = workbook.sheet_names()[0]
    print(sheet_name)
    # 根据sheet名称获取sheet内容
    sheet = workbook.sheet_by_name('EMDT抽取及挖掘结果.xlsx')
    # 打印sheet名称，行数，列数
    print(sheet.name, sheet.nrows, sheet.ncols)

    cols = sheet.col_values(0)

    random.shuffle(cols)

    for index,i in enumerate(cols[:100]):
        print('第{}个问题：{}'.format(index,i))
    """

    test = [
        '对象存储服务 权限使用',
        '关系型数据库 安全套接层',
        '软件开发云 获取项目下所有仓库信息',
        '联络中心 强制签出带原因码 响应消息',
        '云服务器备份 资源管理',
        '数据接入服务 修订记录 修改了响应参数章节响应参数。',
        '弹性云服务器 如何修复虚拟化驱动异常的弹性云服务器？ 操作场景',
        '人工智能服务 示例代码 importjava.io.InputStream;',
        '联络中心 查询是否为质检员 错误结果码',
        'Anti-DDoS流量清洗 服务使用方法 uri',
        '联络中心 发送便签(扩展) 前置条件',
        '产品新特性 15.09.2016 【关系型数据库】RDS支持从备份中恢复到新MySQL数据库实例',
        '云硬盘 创建云硬盘（OpenStack原生） 响应',
        'Anti-DDoS流量清洗 ACKFlood 黑洞状态',
        'OBS_CSDK 创建桶(支持证书)（CreateBucketCA） 示例代码',
        '云解析服务 删除公网Zone',
        '云监控服务 查询监控数据 功能介绍',
        '对象存储服务 获取对象ACL 错误响应消息',
        '联络中心 停止监视 接口说明',
        '统一身份认证服务 生成AK/SK',
        '虚拟私有云 更新网络 接口约束',
        '对象存储服务 获取桶的通知配置 请求消息样式',
        '虚拟私有云 查询浮动IP列表',
        '安全指数服务 资料下载',
        '镜像服务 添加镜像成员 URI',
        '联络中心 OnlineAgentServlet.java文件源码 caseGlobalConstant.FORCELOGIN:',
        '人工智能服务 开通文字识别服务',
        '函数服务 函数定义',
        '对象存储服务 取回归档存储对象 响应消息样式',
        '虚拟私有云 查询路由器列表 接口约束',
        '云硬盘备份 查询备份策略 返回值',
        '软件开发云 项目动态 功能介绍',
        '微服务云应用平台 如何绑定弹性IP？',
        '云硬盘备份 示例代码 publicAccessServiceImpl(StringserviceName,Stringregion,Stringak,',
        '软件开发云 创建项目 URI',
        '消息通知服务 Token认证 调用接口步骤',
        '软件开发云 操作流程',
        '统一身份认证服务 更新用户组 URI',
        '联络中心 关闭文字交谈 代码示例',
        '数据调度服务 示例代码 importjava.io.IOException;',
        '数据查询服务 查看作业结果',
        '会议 REST接口使用说明 相关约定',
        '多维交互分析服务 查看集群补丁信息 请求',
        '数据查询服务 UQuery支持对接哪些数据源',
        '对象存储服务 列举桶内对象 多版本响应实例',
        '云容器引擎 发起请求',
        '对象存储服务 错误响应消息格式',
        '裸金属服务器 裸金属服务器操作系统是否有图形界面？',
        '会议 概述 HelloWorld开发流程',
        '云解析服务 查询版本号',
        '多维交互分析服务 获取文件列表 响应',
        '对象存储服务 批量删除对象 响应实例',
        '分布式消息服务 修订记录',
        '对象存储服务 列举多段上传任务',
        '联络中心 callcontrol.js文件源码 $("#textChatDrop").click(function(){',
        '虚拟私有云 查询子网 返回值',
        '软件开发云 操作流程 操作流程介绍在“项目管理”中，Scrum流程项目的基本操作流程，如图1所示。图1基本使用流程',
        '弹性云服务器 查询指定云服务器网卡信息 返回值',
        '联络中心 强制签入 响应消息',
        '联络中心 停止监视',
        '软件开发云 购买项目管理',
        '弹性伸缩服务 查询弹性伸缩配置列表',
        '联络中心 查询指定座席的保持数 注意事项',
        '关系型数据库 Token认证 应用场景',
        '华为云服务 企业上云套件购买攻略',
        '弹性云服务器 修改云服务器',
        '联络中心 查询所属VDN签入座席的电话号码 响应消息',
        '云监控服务 网页防篡改监控指标说明 监控指标',
        '统一身份认证服务 删除项目对应的用户组的权限 响应',
        '对象存储服务 获取桶的生命周期配置 请求消息元素',
        '对象存储服务 设置桶的多版本状态 请求消息头',
        'OBS_CSDK 获取桶配额(支持证书)（GetBucketQuotaCA） 方法定义',
        '镜像服务 公共消息头',
        '对象存储服务 获取对象元数据 请求消息参数',
        '关系型数据库 通过控制台可以修改哪些参数项（MySQL） innodb_ft_aux_table',
        '文档数据库服务 支持与限制的命令 命令类别',
        '虚拟私有云 删除弹性IP',
        '会议 资源下载 SDK下载',
        '云容器引擎 获取请求认证 Token认证：通过Token认证通用请求。由于开源接口多使用Token认证，因此调用开源接口，优先使用Token认证。',
        '弹性云服务器 查询FPGA镜像详情列表 请求参数',
        '云容器引擎 获取集群信息和获取host信息',
        '产品新特性 03.07.2017',
        '联络中心 查询是否为班长 触发事件',
        '联络中心 查询指定IVR所有排队等待呼叫信息 接口说明',
        '人工智能服务 示例代码 下面代码展示了如何对一个请求进行签名，并通过HTTPClient发送一个HTTPS请求的过程：',
        '会议 桌面协同与共享业务初始化 注意事项',
        '云硬盘 删除云硬盘',
        '关系型数据库 冷备份',
        '云解析服务 示例代码 Demo.java:',
        '云硬盘备份 查询备份详细信息列表',
        '关系型数据库 用户平时需要关注实例的哪些监控指标',
        '云监控服务 服务使用方法 uri',
        'OBS_CSDK 设置桶策略（SetBucketPolicy）',
        '数据调度服务 开始运行Pipeline 状态码',
        '弹性云服务器 附录 提交任务类请求结果',
        '消息与短信 超文本传输安全协议',
        '联络中心 取消侦听和插入 错误结果码',
        '联络中心 补充答复 错误结果码',
        '数据查询服务 查询导入和导出作业细节',
        '会议 设备管理 流程说明',
    ]

    p1 = [
        '对象存储服务的权限使用是什么？',
        '关系型数据库的安全套接层是什么？',
        '软件开发云如何获取项目下所有仓库信息？',
        '联络中心强制签出带原因码的响应消息是什么？',
        '云服务器备份的资源管理是什么？',
        '修改了响应参数章节响应参数。',
        '如何修复虚拟化驱动异常的弹性云服务器？',
        'importjava.io.InputStream;',
        '查询是否为质检员',
        'Anti-DDoS流量清洗服务使用方法的uri是什么？',
        '联络中心发送便签(扩展)的前置条件是什么？',
        '15.09.2016',
        '创建云硬盘（OpenStack原生）的响应是什么？',
        'Anti-DDoS流量清洗ACKFlood的黑洞状态是什么？',
        '创建桶(支持证书)（CreateBucketCA）的示例代码是什么？',
        '云解析服务如何删除公网Zone？',
        '云监控服务查询监控数据的功能介绍是什么？',
        '对象存储服务获取对象ACL的错误响应消息是什么？',
        '联络中心停止监视的接口说明是什么？',
        '统一身份认证服务如何生成AK/SK？',
        '虚拟私有云更新网络的接口约束有哪些？',
        '对象存储服务获取桶的通知配置的请求消息样式是什么？',
        '虚拟私有云如何查询浮动IP列表？',
        '安全指数服务的资料下载有哪些？',
        '镜像服务添加镜像成员的URI是什么？',
        'OnlineAgentServlet.java文件源码',
        '人工智能服务如何开通文字识别服务？',
        '函数服务的函数定义是什么？',
        '取回归档存储对象的响应消息样式是什么？',
        '虚拟私有云查询路由器列表的接口约束是什么？',
        '云硬盘备份查询备份策略的返回值是什么？',
        '软件开发云项目动态的功能介绍是什么？',
        '如何绑定弹性IP？',
        'publicAccessServiceImpl(StringserviceName,Stringregion,Stringak,',
        '软件开发云创建项目的URI是什么？',
        '消息通知服务Token认证的调用接口步骤是什么？',
        '软件开发云的操作流程是什么？',
        '统一身份认证服务更新用户组的URI是什么？',
        '联络中心关闭文字交谈的代码示例是什么？',
        'importjava.io.IOException;',
        '数据查询服务如何查看作业结果？',
        '会议REST接口使用说明的相关约定有哪些？',
        '多维交互分析服务查看集群补丁信息的请求是什么？',
        'UQuery支持对接哪些数据源',
        '对象存储服务列举桶内对象的多版本响应实例是什么？',
        '云容器引擎如何发起请求？',
        '对象存储服务的错误响应消息格式是什么？',
        '裸金属服务器操作系统是否有图形界面？',
        '会议概述的HelloWorld开发流程是什么？',
        '云解析服务如何查询版本号？',
        '多维交互分析服务获取文件列表的响应是什么？',
        '对象存储服务批量删除对象的响应实例？',
        '分布式消息服务的修订记录有哪些？',
        '对象存储服务如何列举多段上传任务？',
        'callcontrol.js文件源码',
        '虚拟私有云查询子网的返回值是什么？',
        '操作流程介绍在“项目管理”中，Scrum流程项目的基本操作流程，如图1所示。图1基本使用流程',
        '查询指定云服务器网卡信息的返回值是什么？',
        '联络中心强制签入的响应消息是什么？',
        '联络中心如何停止监视？',
        '软件开发云的如何买项目管理？',
        '如何查询弹性伸缩配置列表？',
        '联络中心查询指定座席的保持数的注意事项有哪些？',
        '关系型数据库Token认证的应用场景有哪些？',
        '华为云服务的企业上云套件购买攻略是什么？',
        '如何修改云服务器？',
        '联络中心查询所属VDN签入座席的电话号码的响应消息是什么？',
        '云监控服务网页防篡改监控指标说明的监控指标有哪些？',
        '统一身份认证服务删除项目对应的用户组的权限的响应是什么？',
        '对象存储服务获取桶的生命周期配置的请求消息元素是什么？',
        '对象存储服务设置桶的多版本状态的请求消息头是什么？',
        '获取桶配额(支持证书)（GetBucketQuotaCA）的方法定义有哪些？',
        '镜像服务的公共消息头有哪些？',
        '对象存储服务获取对象元数据的请求消息参数是什么？',
        '通过控制台可以修改哪些参数项（MySQL）',
        '文档数据库服务支持与限制的命令的命令类别有哪些？',
        '虚拟私有云如何删除弹性IP？',
        '会议资源下载的SDK下载？',
        'Token认证：通过Token认证通用请求。由于开源接口多使用Token认证，因此调用开源接口，优先使用Token认证。',
        '弹性云服务器查询FPGA镜像详情列表的请求参数有哪些？',
        '云容器引擎的如何获取集群信息和获取host信息？',
        '03.07.2017',
        '查询是否为班长',
        '联络中心查询指定IVR所有排队等待呼叫信息的接口说明是什么？',
        '下面代码展示了如何对一个请求进行签名，并通过HTTPClient发送一个HTTPS请求的过程：',
        '会议桌面协同与共享业务初始化的注意事项有哪些？',
        '如何删除云硬盘？',
        '关系型数据库的冷备份是什么？',
        'Demo.java:',
        '云硬盘备份如何查询备份详细信息列表？',
        '用户平时需要关注实例的哪些监控指标',
        '云监控服务服务使用方法的uri是什么？',
        '如何设置桶策略（SetBucketPolicy）？',
        '数据调度服务开始运行Pipeline的状态码是什么？',
        '弹性云服务器附录如何提交任务类请求结果？',
        '消息与短信的超文本传输安全协议是什么？',
        '联络中心取消侦听和插入的错误结果码是什么？',
        '联络中心补充答复的错误结果码是什么？',
        '数据查询服务的查询导入和导出作业细节是什么？',
        '会议设备管理的流程说明是什么？',
    ]

    p2 = [
        '对象存储服务的权限使用？',
        '关系型数据库的安全套接层？',
        '软件开发云的获取项目下所有仓库信息？',
        '联络中心强制签出带原因码的响应消息？',
        '云服务器备份的资源管理？',
        '修改了响应参数章节响应参数。',
        '修复虚拟化驱动异常的弹性云服务器？',
        'importjava.io.InputStream;',
        '查询是否为质检员',
        'Anti-DDoS流量清洗服务使用方法的uri？',
        '联络中心发送便签(扩展)的前置条件？',
        '15.09.2016',
        '创建云硬盘（OpenStack原生）的响应？',
        'Anti-DDoS流量清洗ACKFlood的黑洞状态？',
        '创建桶(支持证书)（CreateBucketCA）的示例代码？',
        '云解析服务的删除公网Zone？',
        '云监控服务查询监控数据的功能介绍？',
        '对象存储服务获取对象ACL的错误响应消息？',
        '联络中心停止监视的接口说明？',
        '统一身份认证服务的生成AK/SK？',
        '虚拟私有云更新网络的接口约束是什么？',
        '对象存储服务获取桶的通知配置的请求消息样式？',
        '虚拟私有云的查询浮动IP列表？',
        '安全指数服务的资料下载是什么？',
        '镜像服务添加镜像成员的URI？',
        'OnlineAgentServlet.java文件源码',
        '人工智能服务的开通文字识别服务？',
        '函数服务的函数定义？',
        '取回归档存储对象的响应消息样式？',
        '虚拟私有云查询路由器列表的接口约束？',
        '云硬盘备份查询备份策略的返回值？',
        '软件开发云项目动态的功能介绍？',
        '绑定弹性IP？',
        'publicAccessServiceImpl(StringserviceName,Stringregion,Stringak,',
        '软件开发云创建项目的URI？',
        '消息通知服务Token认证的调用接口步骤？',
        '软件开发云的操作流程？',
        '统一身份认证服务更新用户组的URI？',
        '联络中心关闭文字交谈的代码示例？',
        'importjava.io.IOException;',
        '数据查询服务的查看作业结果？',
        '会议REST接口使用说明的相关约定是什么？',
        '多维交互分析服务查看集群补丁信息的请求？',
        'UQuery支持对接哪些数据源',
        '对象存储服务列举桶内对象的多版本响应实例？',
        '云容器引擎的发起请求？',
        '对象存储服务的错误响应消息格式？',
        '裸金属服务器操作系统是否有图形界面？',
        '会议概述的HelloWorld开发流程？',
        '云解析服务的查询版本号？',
        '多维交互分析服务获取文件列表的响应？',
        '对象存储服务批量删除对象的响应实例？',
        '分布式消息服务的修订记录是什么？',
        '对象存储服务的列举多段上传任务？',
        'callcontrol.js文件源码',
        '虚拟私有云查询子网的返回值？',
        '操作流程介绍在“项目管理”中，Scrum流程项目的基本操作流程，如图1所示。图1基本使用流程',
        '查询指定云服务器网卡信息的返回值？',
        '联络中心强制签入的响应消息？',
        '联络中心的停止监视？',
        '软件开发云的的买项目管理？',
        '查询弹性伸缩配置列表？',
        '联络中心查询指定座席的保持数的注意事项是什么？',
        '关系型数据库Token认证的应用场景是什么？',
        '华为云服务的企业上云套件购买攻略？',
        '修改云服务器？',
        '联络中心查询所属VDN签入座席的电话号码的响应消息？',
        '云监控服务网页防篡改监控指标说明的监控指标是什么？',
        '统一身份认证服务删除项目对应的用户组的权限的响应？',
        '对象存储服务获取桶的生命周期配置的请求消息元素？',
        '对象存储服务设置桶的多版本状态的请求消息头？',
        '获取桶配额(支持证书)（GetBucketQuotaCA）的方法定义是什么？',
        '镜像服务的公共消息头是什么？',
        '对象存储服务获取对象元数据的请求消息参数？',
        '通过控制台可以修改哪些参数项（MySQL）',
        '文档数据库服务支持与限制的命令的命令类别是什么？',
        '虚拟私有云的删除弹性IP？',
        '会议资源下载的SDK下载？',
        'Token认证：通过Token认证通用请求。由于开源接口多使用Token认证，因此调用开源接口，优先使用Token认证。',
        '弹性云服务器查询FPGA镜像详情列表的请求参数是什么？',
        '云容器引擎的的获取集群信息和获取host信息？',
        '03.07.2017？',
        '查询是否为班长',
        '联络中心查询指定IVR所有排队等待呼叫信息的接口说明？',
        '下面代码展示了的对一个请求进行签名，并通过HTTPClient发送一个HTTPS请求的过程：',
        '会议桌面协同与共享业务初始化的注意事项是什么？',
        '删除云硬盘？',
        '关系型数据库的冷备份？',
        'Demo.java:',
        '云硬盘备份的查询备份详细信息列表？',
        '用户平时需要关注实例的哪些监控指标',
        '云监控服务服务使用方法的uri？',
        '设置桶策略（SetBucketPolicy）？',
        '数据调度服务开始运行Pipeline的状态码？',
        '弹性云服务器附录的提交任务类请求结果？',
        '消息与短信的超文本传输安全协议？',
        '联络中心取消侦听和插入的错误结果码？',
        '联络中心补充答复的错误结果码？',
        '数据查询服务的查询导入和导出作业细节？',
        '会议设备管理的流程说明？',
    ]
    question_list = []
    diff_list = []
    confusion_list = []
    LAMBDA = 0.9
    ALPHA = 1.2# 0.6 closest 1.2 best
    BETA =0.05
    for index, i in enumerate(test):
        q = QGDT(i,
                 LOG_ENABLE=False,
                 LOG_LEVEL='DEBUG',
                 RANDOM_SAMPLE=False,
                 LAMBDA=LAMBDA,
                 ALPHA=ALPHA,
                 BETA=BETA)

        q.ranking_algorithm()

        question_list.append(q.question_generation())
        diff_list.append(q.diff)
        confusion_list.append(q.confusion)
        print('生成第{}个问题：{}'.format(index, question_list[-1]))

    p1_count = 0
    p2_count = 0
    for index, i in enumerate(question_list):
        if i == p1[index]:
            p1_count += 1
            p2_count += 1
        elif i == p2[index]:
            p2_count += 1
        print('第{}个问题:{}'.format(index, i))
    if LAMBDA < 1:
        print('相似度参数|相似度调节因子：{}，平均极差：{}'.format(ALPHA, round(sum(confusion_list)/len(confusion_list), 2)))
    if LAMBDA > 0:
        print('频度参数|频度调节因子：{}，极差/方差：{}'.format(BETA, round(sum(confusion_list)/len(confusion_list), 2)))
    print('1平均精度：{}，2平均精度：{}'.format(round(p1_count / index, 2), round(p2_count / index, 2)))
